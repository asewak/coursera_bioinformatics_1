# -*- coding: utf-8 -*-
"""
Created on Sat Mar 17 19:31:23 2018

@author: Ainesh
"""


def pattern_to_number(pattern):
    
    unique_letters = 'ACGT'
    if pattern == '':
        return(0)
    # only last symbol
    symbol = pattern[-1]
    # last symbol removed
    prefix = pattern[:-1]
    out = 4 * pattern_to_number(prefix) + unique_letters.index(symbol)
    return(out)


def number_to_pattern(index, k):
    unique_letters = 'ACGT'
    if k == 1:
        return(unique_letters[index])
    prefix_index = index // 4
    r = index % 4
    symbol = unique_letters[r]
    prefix_pattern = number_to_pattern(prefix_index, k - 1)
    out = prefix_pattern + symbol
    return(out)

# super fast
def compute_frequencies(text, k):
    frequency_array = [0] * 4**k
    for index in range(0, len(text) - k + 1):
        pattern = text[index:index + k]
        index = pattern_to_number(pattern)
        frequency_array[index] += 1
    return(frequency_array)



def efficient_clump_finding(genome, k, L, t):
    frequent_patterns = []
    clump = [0]*4**k
    text = genome[0:L]
    frequency_array = compute_frequencies(text, k)
    for i in range(0, 4**k - 1):
        if frequency_array[i] >= t:
            clump[i] = 1
    for i in range(1, len(genome) - L):
        
        first_pattern = genome[i - 1 : i - 1 + k]
        index = pattern_to_number(first_pattern)
        frequency_array[index] = frequency_array[index] - 1
        
        last_pattern = genome[i + L - k : i + L]
        index = pattern_to_number(last_pattern)
        frequency_array[index] = frequency_array[index] + 1
        if frequency_array[index] >= t:
            clump[index] = 1
    for i in range(0, 4**k - 1):
        if clump[i] == 1:
            pattern = number_to_pattern(i, k)
            frequent_patterns.append(pattern)
            frequent_patterns = list(set(frequent_patterns))

    return(frequent_patterns)


genome = 'TGGATGACTACTCGGCAAAGCCAAGTCGGGTATTCGGCCGACTGTACTCAAGAGTCATATCGGTGGACGTCGATACTATAACGCCCGACTGAGCAGAGACTAACTCTTCCCCCGGGTGCAAGGTAAGAACAAACCCGTAGGTTGTCGGCGAATGACACACACAGCGACGATCACTGCGTAGGACTACAGTCGGGGTAAACATCCATCGTGCAGCGCGGGGTACGCGGGGTCTTTTTTCACGGTAGTAGAGAATTCTACCATTAATCCCAGAGGAGTTAAGACGATCGACAAGCGATGAGGCCAAACATTAGGCCCAAGCGACGGGGCTAGTCGCAGTGTTATATGATAAGGACAGAAGGCAAAGTGAGGAGTGTTCAAGGAGATTCATGACGCAAGAGGAGTCCGTCGAGGCCAATAGTGCTCACTGGAGAAGAGTTGATCTGCTATTCTGGTCTCATCTTGGAAGCTACCGTTATGCGACGGACGGAAGATGTGTGGCGGCAACGATACTATCATTATGAGGAGGCCGTGAAGTATTTTACGTTTCCAATTGCACTGGTCAGTCGAGTTGGGGTTAAATGCTCGCTGACGACTGTCGATCAAGCGCTGTTCTCTGCTTGGTGGAACATTATAGGGAAAAAGCAGTTGGGGTGTCTGTTATGTGTGGATGTTTCGGGGTTCCTGCCCTTCATCGGGACAAGATTAAGTTGGGGCTGGTATAACCTCATCATCACGACGAGTCTCGTGCACACATTTGGATCTCTGTTAACGTCTATGACTTGGGCGCATAGAAACGCTTTACGACCGTTTGCGAAGGTGTGCGTCCGTTGAATGTATAATTCATTCTGTGAGTCACAAATTCTGTGAGTCCTCGACACTACCCCAATTCTGTATTCTGTATTCTGTGAGTCTGGTATCTAATTCTGTGAGTGCGTCGGCATCGACTAACTGGTGTCAAGGGCATTAGCCTTATTCTGTGAGTCCATCTGTTAGGCTAATTATTCTGTGAGTAGTTACCTTTAGTGGAATTATTCTGTGAGTTGTGAGTTCCACGGCATTATTCTGTGAGTCGCTTGTATTCTGTGAGTACGAGGATTCTGTGAGTACAGCTTTGGCTATTCTGTGAGTAGCATAAAGCATCGATCGAAAGAGATTCTGATATTCTGTGAGTTCTGTGAGTTATTCTGTGAGTTGTAGTTCCACTCTGGTATGTCCTGTCTGTCCCTTTTCCAGGTCAGCATAGGAATCGCCATACAGCCCCAGGATCATTCTGTATTCTGTGAGTCATTCTGTGAGTCGCTAGCGGCATCTAGACATTCTGTGAGTGGTTCTCGGTGCAATTCTGTGAGTCCGCCGTATTCTGTGATTCTGTGAGTGTGAGTACTCCCCTCATACCTCGATCCCTCATACCTGAGTAGATTCTGTGAGTCTCACTCCATGTACCCTCATACCTATACCTACCAAACCCTCATACCTACCCCTCATACCTCCTAACCGTGCCCCCTCATACCTCTGTCCCTCATACCTTACCGGGGAGCCCTCCCTCATACCTACCCCCTCATACCTGGACCGTACTTCACAGAGTAGTCCCTCATACCCTCATACCTCAGATCCCTCATACCTAGATACGGAGCGCGGCACCCCCCCCTCATACCTCATACCTTTGATTCGCCCCCCTCATACCTCATACCTTGCTGAAGTAAGTATCCTCATTTTATCACGGACCCCTCATACCTAGCGCCGCCAACATCCCTCATACCTACCCTCATACCTGAAAAAGAAACGGAGCGAGTCTATGCCCCTCATACCTCTCCGCCCTCATACCTAACAACTCGTCCCTCATACCTCCTCATACCTCGGCCCTCATACCTAACGGAGCGTCTGCACCCAGAAACAGAAACGGAGCGGACCTGACCTATGTGTTTTAATTCCCTCATACCTCCCCTCATACCTAGCGAAACGGAGCCATGGTCTGAGAAACGGAGCTAGAAACGGAGCCACCTGGTCATTAATTTATGTATTATGTCTGCACCGAGAAACGGAGCGCCTGCAAGAAACGGAGCTTGCCATATGTCTGCACTCTCGGAGAAACGGAGCAGCCGGAGCTCTGCACTATTATGTCTGCACGTCAGAAACGGAGCAAGAAACGGAGCGAAACGGAGCAGAAAAGAAACGGAGCATGTTATGAGAAACGGAAGAAACGGAGCCCGGAGCACGGAGCTCATTACGCAGAAACGGAGCGCCAAGAAACGGAGCGCACGAGACTATGTCTGCAGAAACGGAGCCTATGTCTAGAAACGGAGCGCACCCGGTATGTCTGCAAGAAACGGAGCGAAACGGAGCTATGGTTTAAAGGCTATGTCTGCACCTATGTCTGCACGACCGTTATGTCTGCACCTTAGCAGGCTATGTCTATGTCTGCACACAACGAGTGCAGGAGCATCATCGCCTAGCAGTTTACGTCCTGTTGATGCATCTCATGCGGATGAGGGCAGCCACGTTGGAAAACCACACTCACAACCCATACCGAATATCTGCAACAACGTTGGAAAAGACACATGAATACGGCCCCGATAGGGTTCGTGTACGTTGGAAAAGTTGGAAACGTTGGAAAACTAGGCACAACGTTGGAAAAAACCACGTTGGAAAAACGTTGGAAAAAACGTTGGAAAAAACAAACACGTTGGAAAAGTGATGACGTTGACGACGTTGGAAAACGTTACGTTGGAAAAAGCGACGACGTACGTTGGAAAAAAAAACGTACGTTGGAAAAAAAACGTTGGAAAAGGAAAACCTGTACGTTGGAAAACGTGGCACTCGATGCTTAGTGGGTGACTGTCTACAGTAGATACGTTGACGTTGGAAAAGGAAAATCGCCACACGTTGGAAAATAACGACGTTGGAAAAGTATCAACGCTTCTCCAATGACCAGGGTGCGAACACGTTGGAAACGTTGGAAAAAGGAGCCGACGTTGGAAAAACCCATAAGTGACGTTGGAAAATTTGTGAACGTTGGACGTTGGAAAATGCGAACAACGAAGCCCAAGTTCTTTCAATTTTGGCATCACCTCAGGCCCCGGGGACTTGGTAGTGTGATGACATCATGCATATAGTCTGTAGTCTTACTAGCGTTGCGTTCTTGTAGACGCTCGAATTCCAACGACCGCGCGTCCCTTAACCATCGCCCTCTGCCATATGGAAGCGAACTGACCCCAGTCTGCAGGTCAACTGCCCTGCAAAAAAGCTCCTTCCGCCACACCACGGAACTCATTCGACCCTCACGTCCCCTACGTTAAGCAATATTGCCGGATTCAACCGAACACACGGCGCGCGGTCAATAGGGATACGATCGGTCGCGAAGCGTTGACCACCCGTCTTAGGTGGAAACCGAACAGGGTCGCATGAAAATAATCTAAGGATGAGCTTGCGCCTACTGAAATACGTCTGGATTTCATAGCTCGTACCGGCCGTCCCTAAATCCGAACGACGCTATCCCGAATTAGTGGCTTTTTCAGTCCGATGAAATCAATGGTTGAGGATCCAGATACCTGTCATCTCAGCCTACTAAGCCTCGAGGCGTATTAAGGCAAGTCCCTAGGACGTATCAAATGGTCACGGGAGCGGACTCAAGGGCCTGAGCTATTAGAGTCCATAGACCCCCTTAGTGTTGTTTCTGGAAACCCCCAAGTAGTGGTCTTCTAATGGAGCGCATAACCTCTTTGGAACCGAGGCTCGACTAACGCTATCGATCGTTTCCGTGGCCCAAGTACCCCTCTTCCATTCCCGGAGAAAGGCTTTGACGAAACGTGCACAGTTGTCGTACCACGGAATGGGCATTTGGTCATGCCGAGTTAATCCTCGTCGCACTTAGGGTAATCTGTCACTCATGCACTACTAGCCCTTAGCAGCACAATTAATCAGAGCTTCTACGTTGCGTTTAGTAACTCAGGTATTCTAAACTAGTCATCTCTTCCGTGGTCCATTGCGAAACCCAACACGGAGGTCATATAGGTTATGCGCGGCACTTGTATCTTGCAACGTGTCATTAGTTAGGTATGTGAGCGCGTTATCTCGCTGGGGATCCAACTCAAAGTAAAATGACATACTTTCGCATACTGCTAAAGAATCGAAGGATCGGGTGCCGACCCTTCAACGCTGCTACTAACCAAGATTCTATCAGGAGCATTTACTCGCGCACCCCTATTTTCAACCATGGTCTTCGAGAGTCTGCTAAAACTAGGTGTGTTTAATTCGCAGGGTGTTGCCCCTGTGTCCATAAAAGCGTTTTCCCCTAAGCCAAGGGGAAGTTAACTTGGACGAGTCGAGTCGGTAGGTGGTGCCACTCACCTTGAGTACTGCAGCCCTCTGTCAGCTAAGATCAGTAAGGGAGTGGTATGACTTTACCGGCAGACACAATGTGTCACGACCAGCCGGCAAATCTTGAGTTCACTTCCCGGCAGCCGCACATAAAGCCGGCGAGGTCCAGTACCTCTGCGTTACTCTTTATCCCCCGGCGGGAACAAATCTTGCGGCTGACGCGAAAGTAATTTAGCCAGCCAGATCTAAGCGATTCAATGTGAAATCATAAAACCCTGACAGCAAGTGGTCTTGCGACCCTAATCTCCAGACTTTAGTCTCCTGACCTAATGAAGCAGCACTAGATGATGCTGTCGCGGCAGCGACAGAAGGTCAACGCAACACCACATTCACCCCGGTCGTACGTAGCCGACCTGCTCCTCAAGATTCCCCTATCAACTAACTGAAGCGCTCCTACTTGGCCCTTCCCTGGGAACGTACTGAAGTAAATGAGTTGTAGATTCCCCGATGCTCTGCATGGCACGGAGGGCACGGAGTAATGGAATGGCACGGAGACGGAGTATCCTGGATATGGCACGGAGGCCTCGAGTAATGGCACGGAGAAGGGAGACTGACAGCGACCAAGAAGGCGCTAGGGACAGCTAAAAAATGGCACGGAGGACGCCAGCAAGAATGGCACGGAGACGGAGAATGTTTAAGAAAGTGCATGGCATGGCACGGAGTCAATGGCACGGAGCGGAGGCCCCTTTATGGCACGGAATGGCACGGAGCCAGCAGGGACACACATGCGCATTATATGGCACGGAGATCCGTATGACGAATTTTCCTGAACAGTAAAGCTTGATAACTGTAAGACCCTAGAATTTTCCTGCGGAGACGGAGTGAATTTTCCTGTGGCACGGAGCATGGCACGGATGGCGAATTTTCCTGTGTGCTAATCGAATTTGAATTTTCCTGCGGAGGAGGAATTTTCGAATTTTCCTGTTTCCTGGGAGGGCACGGAGGTAACCGAATTTTCCTGGCAGAATTTTCCTGGGCACGGAGGCCGTCCATGGGAATTTTCCTGGAGGGAATGAATTTTCCTGAAATCAGGTTCATTTCAGGAATTTTCCTGGTACCCTGGGGGCCCGAAAAGAAGAATTTTCCTGCTCAATCTTGAATTTTCCTGCAGTCCTATACGTACCAGGTAGTTGGCTATGGCCCAATTCGGAATTTTCCTGGCAGGGAATTTTCCTGCCTTCGAATTTGAATTTTCCTGTTCCTGCTCCATGCATCGGAAGAAGAATTTTCCTGCTGAGAATTTTCCTGACGCACGTGACCTAACACCGTCTTCGTGTGTGCCTGGAATTTTCCTGTTTTGAATTTTCCTGTGTCCGAATTTTCCTGCAGCCGGTGTGGCGATCGACGGGCTTTCGTTAGATAGTCCAAGCGCCACACTGTCTCCTACTGAGTATGCTAGGTATAGGACCTTTCCACGACAGGAAAATCTTGACCGTGGTTATGATGTACGCGCACCCCAAGCGGTATGCAGTTCAACTGCTAATTATGCGCATGTCGACTCCTATTTAGTTAGCGCATTAGTTGACCAACTCGACGACAGCCAACGCCCGTTTAGCGCCGTAAAGCGAACGATGGTTTACGCGCCCGGCTATAGCATTACCAAGACCCATTGGTTTATGGGATTATATCCCTAGTTAGCAAAGGGACTCCTTTCGCGCTTAGTTCTAATCCCTTATTTTAAAGCCAAACACTATTCCTGGGGTGATTCTTTATGTTAACCCGTCGGGCGCAACCGCCTCCGATAGGTGCACCCGCCAGACATCAGCCCAGACCAACTCCGAATTCTCCATCGTGTTGGTACACACTGCTACCCTTGCTTCGCTTAACATTAGAGTCTTTTGCGGCACGTCATCTCATTACATGCAACAATAAGTGGCGGCTACTCAGGGCAACTAAACCCAACATGACGTTGGATTGTACTCCTATCTCGGACTCCACGCACTCGTTACGTTTTAACCGTACCGTCGTGCGGTAAGGCAGCCCTCACTCCCTAACACCGCTCGGACGTGTGTGGCCAAGGAGAGATGTAAGGTCTGCATATGAACTGCGCAGAGTAAGGAACCGATCGATCTGTTGCTCGCTGCAATCTCCCGCATGGGACAATAGTAAGTGGTCACATAATTGTTCGCTGAGCAGCACTAGGAAGGTTTCACCAAGAAATACTAACCTTTTTGAAGAGACACACGTAAAACCTATGGTCCCGGATTCCAGTGGCACGTGGTAGTCACCGATGCCCTCATGGCATCTCTGGAGTGCGTAGTGTCACGGGTTCGTCACAAATCGTTTTAGCGCTGATAATTAATAGCTTGCGGCACGAGATACATTCGGTCCGACGGGGTAGTGTACTAGTTCTAGGATTTGACGCTTGGTAGCCTTCTCTATGTAGAACTAGCTAGTTTTTTCCGTTCCCCGAGCTGTACTAGATTTTTGAAGTAATAACGTCGTTTTCCTTTTGCTTAGGCGTTTTCCTGTTCAATGCTACTGTACGCGTTGTCTTAATATTCACGTGGCTTGAGAAGACGCAGGGTCTCACTTGGAAGGGCCAATCAGCCGAAGGAGCTACGCGCAGGTCCGTTTCGCCCCCCCAGCTCGAGACCCTTTGGCCAATTTTGGGGTACGCTCAGTAGGACGGCCTTTCCGCTAGATGATCAAGCGGCGCTATGAATCCCGCTAGTGGGATGGCTATGAGCTGTTAGAAGCCCTGCGCGACCGAACAGACGCGTCTCGGGTACCCTGCAGGGCAAATATCTCGGCGGGGGCGCGTATGTTAAGCAGAAGTGCCATAAACTCGGTGAATGCAAAGTGGACTTGGTTTAGGACGACAAAGTGTTTATTTCGACGCATTTCGCCTGTGAGAGCTCTTATGGATGTCTCGCAAAGTACCCTAAAGGGATAGATATTACCCGGTAATCCGAAACTGGTCTGAAATTTTACACCCCCGATTCCATTCAGATGCCCCGAATGGAGCAATGTGGTATGGCATACCGCGAAGTTCGCTGTGAACTGCTGTACAGTTAGCGATCAATTCTCGGCATTAGCGTGACACATATTTTGTTAGATAGAGGTGCTGATACCTTATCGACGATACTCGCTGCATGCACATACTGCTCATACTTTCGAATCTAGATCCGTCGAAATAATCGCGTGGATGAATCCAAGAGCACAGATTCTTACCCATGCGTCCGATAATTGTCCGCCGGTTCTATCAATCTAGGTTTCGTGCTCGCGTGTTATATAAGCGGCAGCTCTTTAACAAAATTCAACAAGGGGGCTACTCGCGCTAGGGGAAAAGGGTGGATGACCCCTGGCTCCCTGCGTTTGGACCCAGTGCTCATGGTATATTGGTGGGTTATAACGACGTGGGGTGCGTACTTTACGTAGGGGGGGATTTGACAATACCCCAACGTTGGATTACGGCCCTTCCCGCATTCCTGAATTCTCGGCAAAGCTCTCACGCGCGGCGCCGAGGAGCGTGCTCATGGAGTGGTTTCTCGAGTTACACGACACAAGCGAAATACGCCTAGTATCCGAAACAGTAAGGGGGCTACAGCCCATGGTGACTGAATCTTAAATTTATAGAGGATAGGTGGACTGTGGTGGCCGCTTAGCCGGACCTGGTCACCTTCGGTTCAACGAGCGGGCTGATCTCTTCATAGAGTTCGTGGGCTTGAATATCTGAGGCAACCTTCCAGAAGGCATCGTGAATGGTACTACGGCTATTTAGTCCAAAGTTGGAATCGGCCTACAAAGCTTTCCCCCGCCATATTATCCCTGTTGATGCTATGTCGCCCTTAGGTAGACAAGACCGCGTTATTCAAAATCCTTTGCTCCATCACATGCGTGAGAAATCGCCGCATGTAGTAGTTGTTCGTATCCTGAAATGCACACTATCCTGGTATTTCTTTCCGCAACTTTCTCCTGGCTCCCTGGGTAATAGTAGTTGCCGGCGTATTTGGCGAGGTCCACGTGGCGTCCCATCTGGGGCTCTATACTTCTAACACATTATAGCCGTGAGACTGATAGTTAAACGTCAGTCAGTGTATCGTCACACTACATATGTTCGATCGGGAGACTGTGTGTATAGGCAACTCTTCCTTAATCTGAGTTAGCGCGCTATAGTACAGCGGGTACTCCTCTCGGATCGGCACAACGAGTCCGCGCAGTCACATTGTCCACTGCCCCAGGCCGTTCACCTCTCGCGTCTACAATTAAAGCCTCGTTAGACTTTCGGGGTTTGAGAGACTTTCGGGCTGAAGGTGTGAAGTGTGAACACAGTACAGTACAACGCACAGTAGCACAGTATTCGAAGGTGTGAAAACTTTCGGGTCGAAGGTGTGAAAGGTGTGAAAGTATTGAAGGTGTGAAAGTACTTTGAAGGTGTGAAACAGGAAGGTGTGAAGAACACAGTACTTGAAGGTGTGAAACGCACAGTAAGCCTAACGCGAAGGTGTGAACAGAAGGTGTGGAAGGTGTGAAACGCACAGAAGGTGTGAGAAGGTGTGAAGAAACTTTCGGGTGAAGGTGTGAATAACGCACAGTAGAAGGTGTGAAAAGGTGTGAACGCCAAACGGAAGAAGGTGTGAAAGCACAGTAGGGACTTTCGGGAAATCATCGTACAAACGGAAGGTGTGAAGTGAAGAGACTTTCGGGTACCGACGAAGGTGTGAATCGAAGGTGTGAAGAAGGTGTGAAACAACGCAAACGCGAAGGTGTGAACCCCCTAACCACCCGAAGGTGTGAAAACCGTAGAAGGTGTGAACGCACAGTATCGGGGACTTTCGGGTCGTAGACTGAAGGTGTGAAAGGTGTGAAGTGTGAAATATGACTGTTACTGCAGGCGGCTGAGTCAACGGTACGTAACGGTTAGGGCTCGGGCCCATCAAGGATCGCCTCTTTCCTGGAAGTACTTAGAGTAAAAGATATGAAATTCTGGGTCCAACATGCTACTTAGGGATAAACAGAACTTGCGTTTCTTGTGCGTAGACCTGTCCTAGGCAATTTTCCGACAAGTTTACGGCCGTGACAGTCAATTTCATTCGGCTGACTCAGTACAATAACATTTAGTAGCTGCCATCGGGCAGGAGAACCCTAAGAAATCAGATAAATAGTCCAGCGTCTCGCAAACTCTTGATGAGGGTATTGCATTGGCCTCCACGCGGTGAATCGAACCTATCTATGTCGTACGCGGGGCACCCCATAATGGGAGTATCAGTAAGTGAGGGAGAGGTCGGACCGGATTATGCTGGTTTGTCTTTCAATACTCGTGTGGGGTAACACTTTTGGTTCTAGTCCTGTCCCCAACGGGAACCTACTAGGGGAATGTGGTTGAACGACCTTGGAACT'
k = 11
L = 493
t = 18
clumps = efficient_clump_finding(genome, k, L, t)
